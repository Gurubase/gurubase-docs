---
title: 'Text-to-Speech Stream V2'
api: 'POST /{guru_type}/text-to-speech-v2/stream/'
description: 'Convert text to speech using ElevenLabs TTS with OpenAI fallback and stream audio response'
---

Convert text to speech using ElevenLabs TTS API with OpenAI fallback and stream the audio response. Code blocks and inline code are automatically processed for better speech generation.

<Note>
This feature requires special activation. Please contact our support team to enable ElevenLabs TTS for your account.
</Note>

<RequestExample>
```bash cURL
curl --request POST \
  --url https://api.gurubase.io/api/v1/gurubase/text-to-speech-v2/stream/ \
  --header 'x-api-key: YOUR_API_KEY' \
  --header 'Content-Type: application/json' \
  --data '{
    "text": "Hello, this is a test message with some code: `console.log(\"hello\")` and a code block:\n```python\ndef hello():\n    print(\"hello\")\n```"
  }'
```

</RequestExample>

## Path Parameters

<ParamField path="guru_type" type="string" required>
  The guru type identifier for the text-to-speech request
</ParamField>

## Headers

<ParamField header="x-api-key" type="string" required>
  Your API key for authentication. You can obtain your API key from the [Gurubase.io](https://gurubase.io/api-keys) dashboard.
</ParamField>

### Body Parameters

<ParamField body="text" type="string" required>
  The text to convert to speech
</ParamField>

### Response

The response is a streaming audio file in MP3 format.

<ResponseField name="audio_stream" type="audio/mpeg">
  Streaming audio response in MP3 format
</ResponseField>

<ResponseExample>
```json 400
{
  "msg": "No text provided"
}
```

```json 401
{
  "error": "Invalid API key"
}
```

```json 403
{
  "msg": "Text-to-speech is not enabled for this guru type"
}
```

```json 429
{
  "error": "Rate limit exceeded"
}
```

```json 500
{
  "msg": "Error generating speech stream"
}
```
</ResponseExample>

## TTS Provider Fallback

This endpoint uses a sophisticated fallback system:

1. **Primary**: ElevenLabs TTS API (if configured and available)
2. **Fallback**: OpenAI TTS API (if ElevenLabs fails or is not configured)

The system automatically handles provider failures and seamlessly switches between providers to ensure reliable audio generation.

## Streaming Response

The endpoint returns a streaming audio response with the following headers:
- `Content-Type: audio/mpeg`
- `Cache-Control: no-cache`
- `X-Accel-Buffering: no` (disables nginx buffering for real-time streaming)

## Code Examples

### Completing the Chunks and Playing the Audio

This example demonstrates how to send a request and start playing once all of the chunks are complete.

```javascript
// Configuration variables
let API_KEY = "your-api-key-here";
let BASE_URL = "https://api.gurubase.com/api/v1";
let GURU_SLUG = "your-guru-slug";

// TTS stream function
async function streamTTS(text) {
  console.log("Converting text to speech: " + text.substring(0, 50) + "...");

  try {
    const response = await fetch(
      `${BASE_URL}/${GURU_SLUG}/text-to-speech-v2/stream/`,
      {
        method: "POST",
        headers: {
          "X-API-KEY": API_KEY,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          text: text
        })
      }
    );

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    // Read stream chunks
    const reader = response.body.getReader();
    const chunks = [];
    let chunkCount = 0;
    let totalBytes = 0;

    console.log("Starting TTS stream...");

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;

      chunkCount++;
      totalBytes += value.length;
      console.log(`Chunk ${chunkCount}: ${value.length} bytes received`);

      chunks.push(value);
    }

    console.log(
      `Stream completed: ${chunkCount} chunks, ${totalBytes} total bytes`
    );

    // Combine all chunks into a single Uint8Array
    const audioData = new Uint8Array(totalBytes);
    let offset = 0;
    for (const chunk of chunks) {
      audioData.set(chunk, offset);
      offset += chunk.length;
    }

    // Create audio blob and return URL
    const audioBlob = new Blob([audioData], { type: "audio/mpeg" });
    const audioUrl = URL.createObjectURL(audioBlob);

    return audioUrl;
  } catch (error) {
    console.log("TTS stream failed: " + error.message);
    throw error;
  }
}

// Example usage
async function playTTS() {
  const text = "Hello. This is a test message.";
  
  try {
    const audioUrl = await streamTTS(text);
    const audio = new Audio(audioUrl);
    
    audio.onended = () => {
      console.log("Audio playback completed");
      URL.revokeObjectURL(audioUrl);
    };
    
    await audio.play();
  } catch (error) {
    console.log("Failed to play TTS: " + error.message);
  }
}
```